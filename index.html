<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ai L√† Si√™u Anh H√πng L·ªõp M√¨nh?</title>

  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.8.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.8.2/firebase-database-compat.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Baloo 2', sans-serif;
      background: linear-gradient(135deg, #a29bfe 0%, #ffeaa7 100%);
      min-height: 100vh;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 30px;
      padding: 40px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.3);
    }
    h1 {
      font-size: 3em;
      margin: 10px 0 15px;
      color: #6c5ce7;
      text-shadow: 3px 3px 0px #fd79a8;
    }
    .subtitle {
      font-size: 1.5em;
      margin-bottom: 25px;
      color: #e84393;
      line-height: 1.4;
    }
    .admin-controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 20px 0;
    }
    .admin-btn {
      background: #6c5ce7;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.3em;
      font-weight: 700;
      border-radius: 20px;
      cursor: pointer;
      font-family: 'Baloo 2', sans-serif;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      transition: all 0.3s;
    }
    .admin-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(0,0,0,0.3); }
    .admin-btn.danger { background: #d63031; }
    .admin-btn.success { background: #00b894; }


    .options { 
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    .option {
      background: #ddd;
      border-radius: 20px;
      padding: 25px 15px;
      cursor: pointer;
      font-size: 1.4em;
      font-weight: 700;
      color: white;
      text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      transition: all 0.3s;
    }
    .option:hover { transform: translateY(-5px) scale(1.03); }
    .option:active { transform: scale(0.98); }
    .option.selected {
      transform: scale(1.05);
      box-shadow: 0 0 40px #ffd700, 0 0 80px #ff0 !important;
      animation: pulse 1.5s infinite;
    }
    .option.disabled { opacity: 0.35; pointer-events: none; filter: grayscale(90%); }
    .nickname {
      font-size: 0.75em;
      opacity: 0.95;
      margin-top: 6px;
      font-weight: 600;
    }
    #message {
      font-size: 1.6em;
      min-height: 60px;
      padding: 15px;
      background: #fff3cd;
      border-radius: 20px;
      margin: 20px 0;
      color: #e17055;
      font-weight: 700;
    }

    /* Top 3 Podium */
    .top3-container {
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 30px;
      margin: 50px 0;
      min-height: 400px;
    }
    .podium {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      animation: slideUp 0.8s ease-out;
    }
    @keyframes slideUp {
      from { transform: translateY(100px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .podium.first { order: 2; }
    .podium.second { order: 1; }
    .podium.third { order: 3; }
    .podium-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3em;
      font-weight: 800;
      color: white;
      margin-bottom: 15px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
      position: relative;
    }
    .podium.first .podium-avatar {
      width: 150px;
      height: 150px;
      font-size: 4em;
      animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    .crown {
      position: absolute;
      top: -40px;
      font-size: 2.5em;
      animation: rotate 3s infinite;
    }
    @keyframes rotate {
      0%, 100% { transform: rotate(-15deg); }
      50% { transform: rotate(15deg); }
    }
    .podium-name {
      font-size: 1.8em;
      font-weight: 800;
      margin: 10px 0 5px;
      color: #2d3436;
    }
    .podium-nickname {
      font-size: 1.1em;
      color: #636e72;
      margin-bottom: 10px;
    }
    .podium-votes {
      font-size: 1.5em;
      font-weight: 700;
      color: #e17055;
      margin-bottom: 15px;
    }
    .podium-base {
      width: 180px;
      border-radius: 15px 15px 0 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 4em;
      font-weight: 800;
      color: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .podium.first .podium-base {
      height: 200px;
      background: linear-gradient(135deg, #f1c40f, #f39c12);
      width: 200px;
    }
    .podium.second .podium-base {
      height: 150px;
      background: linear-gradient(135deg, #bdc3c7, #95a5a6);
    }
    .podium.third .podium-base {
      height: 120px;
      background: linear-gradient(135deg, #e67e22, #d35400);
    }

    .result-item {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      margin: 15px 0;
      padding: 20px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      font-size: 1.3em;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }
    .rank { font-size: 2.5em; margin-right: 20px; min-width: 80px; }
    .progress { height: 30px; background: rgba(255,255,255,0.3); border-radius: 15px; overflow: hidden; margin-top: 10px; }
    .bar { height: 100%; background: #fff; border-radius: 15px; transition: width 1s ease; }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,215,0,0.8); } 70% { box-shadow: 0 0 0 40px rgba(255,215,0,0); } }

    @media (max-width: 768px) {
      .container { padding: 20px; }
      h1 { font-size: 2em; }
      .options { grid-template-columns: 1fr; }
      .top3-container { flex-direction: column; align-items: center; gap: 20px; }
      .podium { order: unset !important; }
      .admin-controls { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>AI L√Ä SI√äU ANH H√ôNG L·ªöP M√åNH?</h1>
    <div class="subtitle">B·∫•m v√†o t√™n b·∫°n m√† b·∫°n tin c√≥ si√™u nƒÉng l·ª±c b√≠ m·∫≠t!</div>

    <div id="adminControls" class="admin-controls" style="display:none;">
      <button id="startBtn" class="admin-btn success">üöÄ B·∫ÆT ƒê·∫¶U VOTE</button>
      <button id="endBtn" class="admin-btn danger">‚èπÔ∏è K·∫æT TH√öC NGAY</button>
      <button id="resetBtn" class="admin-btn">üîÑ RESET TO√ÄN B·ªò</button>
      <button id="qrBtn" class="admin-btn" style="background:#e84393">üì± HI·ªÜN QR CODE</button>
    </div>

    <div id="qrModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:9999;align-items:center;justify-content:center;">
      <div style="background:white;padding:40px;border-radius:30px;text-align:center;max-width:500px;position:relative;">
        <button id="closeQR" style="position:absolute;top:15px;right:15px;background:#d63031;color:white;border:none;width:40px;height:40px;border-radius:50%;font-size:1.5em;cursor:pointer;font-weight:bold;">√ó</button>
        <h2 style="color:#6c5ce7;font-size:2.5em;margin-bottom:20px">üì± Qu√©t M√£ QR</h2>
        <p style="color:#e84393;font-size:1.3em;margin-bottom:20px">ƒê·ªÉ h·ªçc sinh vote ngay!</p>
        <div style="background:#f0f0f0;padding:20px;border-radius:20px;margin:20px 0;">
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=https://capable-melomakarona-c6f045.netlify.app/" style="width:300px;height:300px;display:block;">
        </div>
        <div style="background:#fff3cd;padding:15px;border-radius:15px;word-break:break-all;font-size:1em;color:#333;margin-top:20px;">
          https://capable-melomakarona-c6f045.netlify.app/
        </div>
      </div>
    </div>

    <div id="message">Ch·ªçn ngay m·ªôt ng∆∞·ªùi n√†o!</div>

    <div id="poll" class="options"></div>

    <div id="results" style="display:none;">
      <h2 style="font-size:3em;color:#f1c40f;margin:30px 0;text-shadow:3px 3px 0 #e17055">üèÜ TOP 3 SI√äU ANH H√ôNG üèÜ</h2>
      <div id="top3"></div>
      
      <h2 style="font-size:2.5em;color:#6c5ce7;margin:50px 0 30px">üìä B·∫¢NG X·∫æP H·∫†NG ƒê·∫¶Y ƒê·ª¶</h2>
      <div id="ranking"></div>
      <p style="font-size:1.5em;margin-top:25px;color:#636e72">T·ªïng c·ªông <b id="total-votes" style="color:#e17055">0</b> b·∫°n ƒë√£ vote</p>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAQB47nB58LyMQ1_5DZSCggJK5AhBy-POE",
      authDomain: "poll-sieu-nang-luc.firebaseapp.com",
      databaseURL: "https://poll-sieu-nang-luc-default-rtdb.firebaseio.com",
      projectId: "poll-sieu-nang-luc",
      storageBucket: "poll-sieu-nang-luc.firebasestorage.app",
      messagingSenderId: "743139357944",
      appId: "1:743139357944:web:92fe5cfc03d4414e5e370d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const pollRef = db.ref('sieunangluc-tenhocsinh-2025');
    const votesRef = pollRef.child('votes');
    const endTimeRef = pollRef.child('endTime');
    const duration = 120; // 2 ph√∫t

    // 30 h·ªçc sinh ‚Äì T√äN TR∆Ø·ªöC, BI·ªÜT DANH SAU
    const students = [
      {id:0,  name:"Minh Khang",    nickname:"C·∫≠u B√© Tia Ch·ªõp",      color:"#74b9ff"},
      {id:1,  name:"B·∫£o Ch√¢u",     nickname:"Ph√π Th·ªßy Ph√©p Thu·∫≠t",   color:"#fd79a8"},
      {id:2,  name:"Ph∆∞∆°ng Nam",   nickname:"Si√™u Nh√¢n M·∫∑t Tr·ªùi",    color:"#f1c40f"},
      {id:3,  name:"Ng·ªçc √Ånh",     nickname:"C√¥ng Ch√∫a BƒÉng Gi√°",    color:"#81ecec"},
      {id:4,  name:"Tu·∫•n Ki·ªát",    nickname:"Si√™u Nh√¢n C∆° B·∫Øp",      color:"#e17055"},
      {id:5,  name:"H·∫£i ƒêƒÉng",     nickname:"Ng∆∞·ªùi D·∫´n ƒê∆∞·ªùng",       color:"#00b894"},
      {id:6,  name:"Th·∫£o Vy",      nickname:"N·ªØ Ho√†ng Hoa",          color:"#ff7675"},
      {id:7,  name:"Kh√°nh Linh",   nickname:"Thi√™n Th·∫ßn Nh·ªè",        color:"#a29bfe"},
      {id:8,  name:"Tr√≠ ƒê·ª©c",      nickname:"Th·∫ßn ƒê·ªìng N√£o B·ªô",      color:"#6c5ce7"},
      {id:9,  name:"Y·∫øn Nhi",      nickname:"Ph∆∞·ª£ng Ho√†ng L·ª≠a",      color:"#fdcb6e"},
      {id:10, name:"Ho√†ng Long",   nickname:"R·ªìng V√†ng Bay",         color:"#e84393"},
      {id:11, name:"Mai Anh",      nickname:"B∆∞·ªõm Ti√™n N·ªØ",          color:"#fd79a8"},
      {id:12, name:"ƒê·ª©c Huy",      nickname:"Hi·ªáp Sƒ© √Ånh S√°ng",      color:"#0984e3"},
      {id:13, name:"Th√πy Linh",    nickname:"Ti√™n N·ªØ Gi√≥",           color:"#00cec9"},
      {id:14, name:"Phong",        nickname:"Th·∫ßn Gi√≥ L·ªëc",          color:"#636e72"},
      {id:15, name:"H·ªìng Ng·ªçc",    nickname:"N·ªØ Ho√†ng L·ª≠a",          color:"#d63031"},
      {id:16, name:"Qu·ªëc B·∫£o",     nickname:"Ng∆∞·ªùi B·∫£o V·ªá L·ªõp",      color:"#2d3436"},
      {id:17, name:"Kim Ng√¢n",     nickname:"C√¥ng Ch√∫a B·∫°c",         color:"#b2bec3"},
      {id:18, name:"Vi·ªát Ho√†ng",   nickname:"Vua Chi·∫øn Binh",        color:"#e17055"},
      {id:19, name:"Lan Chi",      nickname:"Hoa Lan Ti√™n T·ª≠",       color:"#ff7675"},
      {id:20, name:"Minh Tu·∫•n",    nickname:"Tia S√©t Si√™u T·ªëc",      color:"#74b9ff"},
      {id:21, name:"Th·∫£o Nguy√™n",  nickname:"N·ªØ Ho√†ng Th·∫£o Nguy√™n",  color:"#00b894"},
      {id:22, name:"H√† My",       nickname:"N√†ng Ti√™n C√°",          color:"#81ecec"},
      {id:23, name:"Tr·ªçng Nghƒ©a",  nickname:"Hi·ªáp Sƒ© C√¥ng L√Ω",       color:"#2ecc71"},
      {id:24, name:"Di·ªáu Linh",    nickname:"Ti√™n N·ªØ √Ånh TrƒÉng",     color:"#a29bfe"},
      {id:25, name:"Kh√°nh An",     nickname:"Thi√™n Th·∫ßn B√¨nh Y√™n",   color:"#fdcb6e"},
      {id:26, name:"T√πng L√¢m",     nickname:"Ng∆∞·ªùi G√°c R·ª´ng",        color:"#55a3ff"},
      {id:27, name:"B√≠ch Th·ªßy",    nickname:"N√†ng Ti√™n N∆∞·ªõc",        color:"#00cec9"},
      {id:28, name:"Nh·∫≠t Minh",    nickname:"M·∫∑t Tr·ªùi B√© Nh·ªè",       color:"#f1cCounts40f"},
      {id:29, name:"C√°t T∆∞·ªùng",    nickname:"Ph√π Th·ªßy May M·∫Øn",      color:"#e84393"}
    ];

    let isVotingActive = true;
    let votes = {};
    const pollDiv = document.getElementById('poll');
    const messageDiv = document.getElementById('message');
    const rankingDiv = document.getElementById('ranking');
    const totalSpan = document.getElementById('total-votes');

    // T·∫°o c√°c √¥ vote: T√™n l·ªõn tr∆∞·ªõc ‚Äì bi·ªát danh nh·ªè sau
    students.forEach(s => {
      const div = document.createElement('div');
      div.className = 'option';
      div.dataset.id = s.id;
      div.style.background = s.color;
      div.innerHTML = `
        <div>${s.name}</div>
        <div class="nickname">${s.nickname}</div>
      `;
      div.onclick = () => vote(s.id);
      pollDiv.appendChild(div);
    });

    // Ki·ªÉm tra ƒë√£ vote ch∆∞a
    if (localStorage.getItem('voted_ten_2025') === 'yes') {
      const chosen = localStorage.getItem('choice_ten_2025');
      document.querySelectorAll('.option').forEach(d => {
        if (d.dataset.id == chosen) d.classList.add('selected');
        else d.classList.add('disabled');
      });
      messageDiv.innerHTML = `B·∫°n ƒë√£ vote cho <b>${students[chosen].name}</b> r·ªìi nha!`;
    }

    endTimeRef.on('value', snap => {
      const endTime = snap.val();
      if (endTime && endTime < Date.now()) {
        isVotingActive = false;
        showResults();
      } else {
        isVotingActive = true;
      }
    });

    votesRef.on('value', snap => {
      votes = snap.val() || {};
    });

    function vote(id) {
      if (localStorage.getItem('voted_ten_2025') === 'yes' || !isVotingActive) return;

      votesRef.child(id).transaction(v => (v||0)+1);
      localStorage.setItem('voted_ten_2025','yes');
      localStorage.setItem('choice_ten_2025',id);

      messageDiv.innerHTML = `Vote cho <b>${students[id].name}</b> th√†nh c√¥ng!`;
      confetti({particleCount:250, spread:100});
      new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3').play().catch(()=>{});

      document.querySelectorAll('.option').forEach(d => {
        if (d.dataset.id == id) d.classList.add('selected');
        else d.classList.add('disabled');
      });
    }

    function showResults() {
      document.getElementById('poll').style.display='none';
      messageDiv.style.display='none';
      document.getElementById('results').style.display='block';

      const total = Object.values(votes).reduce((a,b)=>a+b,0);
      totalSpan.textContent = total;

      const sorted = students.map(s => ({
        ...s,
        votes: votes[s.id]||0,
        percent: total ? (votes[s.id]||0)/total*100 : 0
      })).sort((a,b)=> b.votes - a.votes || a.id - b.id);

      // Hi·ªÉn th·ªã Top 3 v·ªõi podium
      const top3Div = document.getElementById('top3');
      const top3 = sorted.slice(0, 3);
      const medals = ['ü•á', 'ü•à', 'ü•â'];
      const positions = ['first', 'second', 'third'];
      
      top3Div.innerHTML = `
        <div class="top3-container">
          ${top3.map((s, i) => `
            <div class="podium ${positions[i]}">
              ${i === 0 ? '<div class="crown">üëë</div>' : ''}
              <div class="podium-avatar" style="background:${s.color}">
                ${s.name.charAt(0)}
              </div>
              <div class="podium-name">${s.name}</div>
              <div class="podium-nickname">${s.nickname}</div>
              <div class="podium-votes">${s.votes} votes (${s.percent.toFixed(1)}%)</div>
              <div class="podium-base">
                ${medals[i]}
              </div>
            </div>
          `).join('')}
        </div>
      `;

      // Hi·ªÉn th·ªã b·∫£ng x·∫øp h·∫°ng ƒë·∫ßy ƒë·ªß (t·ª´ v·ªã tr√≠ 4 tr·ªü ƒëi)
      rankingDiv.innerHTML = sorted.slice(3).map((s,i) => `
        <div class="result-item" style="background:linear-gradient(135deg, ${s.color}dd, ${s.color})">
          <div class="rank">${i+4}th</div>
          <div style="flex:1;text-align:left">
            <div style="font-size:1.4em;font-weight:700">${s.name}</div>
            <div class="nickname" style="font-size:0.9em;margin:5px 0;opacity:0.9">${s.nickname}</div>
            <div style="font-size:1.1em">${s.votes} l∆∞·ª£t (${s.percent.toFixed(1)}%)</div>
            <div class="progress"><div class="bar" style="width:${s.percent}%"></div></div>
          </div>
        </div>
      `).join('');

      // Hi·ªáu ·ª©ng confetti
      confetti({particleCount:500, spread:120, origin:{y:0.6}});
      setTimeout(() => confetti({particleCount:300, spread:100, origin:{y:0.7}}), 500);
    }

    // N√∫t ƒëi·ªÅu khi·ªÉn cho gi√°o vi√™n
    if (new URLSearchParams(location.search).get('admin')==='123') {
      document.getElementById('adminControls').style.display='flex';
      
      // N√∫t B·∫ÆT ƒê·∫¶U - M·ªü vote cho h·ªçc sinh
      document.getElementById('startBtn').onclick = () => {
        if(confirm('B·∫Øt ƒë·∫ßu vote m·ªõi?')) {
          pollRef.update({endTime: Date.now() + (365*24*60*60*1000)}); // Set th·ªùi gian xa trong t∆∞∆°ng lai
          alert('ƒê√£ b·∫Øt ƒë·∫ßu! H·ªçc sinh c√≥ th·ªÉ vote ngay!');
          location.reload();
        }
      };
      
      // N√∫t K·∫æT TH√öC - D·ª´ng vote ngay l·∫≠p t·ª©c v√† hi·ªán k·∫øt qu·∫£
      document.getElementById('endBtn').onclick = () => {
        if(confirm('K·∫øt th√∫c vote ngay v√† hi·ªÉn th·ªã k·∫øt qu·∫£?')) {
          pollRef.update({endTime: Date.now() - 1000});
          alert('ƒê√£ k·∫øt th√∫c! ƒêang hi·ªÉn th·ªã k·∫øt qu·∫£...');
          setTimeout(() => location.reload(), 500);
        }
      };
      
      // N√∫t RESET - X√≥a to√†n b·ªô d·ªØ li·ªáu v√† b·∫Øt ƒë·∫ßu l·∫°i
      document.getElementById('resetBtn').onclick = () => {
        if(confirm('‚ö†Ô∏è RESET to√†n b·ªô vote?\n(T·∫•t c·∫£ d·ªØ li·ªáu s·∫Ω b·ªã x√≥a)')) {
          pollRef.set({endTime: Date.now() + (365*24*60*60*1000), votes:{}});
          localStorage.removeItem('voted_ten_2025');
          localStorage.removeItem('choice_ten_2025');
          alert('‚úÖ ƒê√£ reset! C·∫£ l·ªõp refresh ƒë·ªÉ vote l·∫°i!');
          location.reload();
        }
      };

      // N√∫t HI·ªÜN QR CODE
      const qrModal = document.getElementById('qrModal');
      document.getElementById('qrBtn').onclick = () => {
        qrModal.style.display = 'flex';
      };
      document.getElementById('closeQR').onclick = () => {
        qrModal.style.display = 'none';
      };
      qrModal.onclick = (e) => {
        if(e.target === qrModal) qrModal.style.display = 'none';
      };
    }

    // Kh·ªüi t·∫°o tr·∫°ng th√°i vote n·∫øu ch∆∞a c√≥
    endTimeRef.once('value').then(s => {
      if(!s.val()) endTimeRef.set(Date.now() + (365*24*60*60*1000)); // M·∫∑c ƒë·ªãnh m·ªü vote
    });
  </script>
</body>
</html>